<script>
    function createGanttChart(data, dependencies) {
        const margin = { top: 50, right: 20, bottom: 50, left: 150 };
        const taskCount = data.length; // Number of tasks
        const width = 1200 - margin.left - margin.right; // Increased width
        const height = Math.max(600, taskCount * 50) - margin.top - margin.bottom; // Dynamically increase height based on tasks

        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Define arrowhead for dependencies
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 10)
            .attr("refY", 0)
            .attr("orient", "auto")
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#888");

        // Parse dates
        const parseDate = d3.timeParse("%Y-%m-%d");
        data.forEach(d => {
            d.start = parseDate(d.start);
            d.end = parseDate(d.end);
        });

        // Define scales
        const x = d3.scaleTime()
            .domain([d3.min(data, d => d.start), d3.max(data, d => d.end)])
            .range([0, width]);

        const y = d3.scaleBand()
            .domain(data.map(d => d.label))
            .range([0, height])
            .padding(0.4); // Increased padding for more space between tasks

        // Add axes
        const xAxis = d3.axisBottom(x).tickFormat(d3.timeFormat("%b %d, %Y"));
        const yAxis = d3.axisLeft(y);

        svg.append("g")
            .attr("class", "x-axis")
            .attr("transform", `translate(0,${height})`)
            .call(xAxis);

        svg.append("g")
            .attr("class", "y-axis")
            .call(yAxis);

        // Add bars
        svg.selectAll(".bar")
            .data(data)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", d => x(d.start))
            .attr("y", d => y(d.label))
            .attr("width", d => x(d.end) - x(d.start))
            .attr("height", y.bandwidth())
            .attr("fill", d => {
                if (d.status === "Completed") return "green";
                if (d.status === "In Progress") return "orange";
                return "red";
            });

        // Add labels
        svg.selectAll(".task-label")
            .data(data)
            .enter()
            .append("text")
            .attr("class", "task-label")
            .attr("x", d => x(d.start) + 5)
            .attr("y", d => y(d.label) + y.bandwidth() / 2 + 4)
            .text(d => d.label);

        // Add tooltip
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        svg.selectAll(".bar")
            .on("mouseover", function (event, d) {
                tooltip.transition().duration(200).style("opacity", 1);
                tooltip.html(`
                    <strong>${d.label}</strong><br>
                    Start: ${d3.timeFormat("%A, %B %d, %Y")(d.start)}<br>
                    End: ${d3.timeFormat("%A, %B %d, %Y")(d.end)}<br>
                    Status: ${d.status}
                `)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 20) + "px");
            })
            .on("mouseout", function () {
                tooltip.transition().duration(200).style("opacity", 0);
            });

        // Add dependency lines
        dependencies.forEach(dep => {
            const sourceTask = data.find(d => d.label === dep.from);
            const targetTask = data.find(d => d.label === dep.to);

            if (sourceTask && targetTask) {
                svg.append("line")
                    .attr("class", "dependency-line")
                    .attr("x1", x(sourceTask.end))
                    .attr("y1", y(sourceTask.label) + y.bandwidth() / 2)
                    .attr("x2", x(targetTask.start))
                    .attr("y2", y(targetTask.label) + y.bandwidth() / 2);
            }
        });
    }
</script>
